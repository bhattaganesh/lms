{% extends "student/dashboard.html" %}

{% block title %}
{{ classroom.subject }}
{% endblock title %}

{% block main %}
    
    {% if classroom %}
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    </div>
        <div class="row mt-3 d-flex">
            <div class="col-12">
                <div class="card">
                    <img src="{{ classroom.image.url }}" alt="{{ classroom.subject }}">
                    <div class="card-body">
                    <h5 class="card-title">{{ classroom.subject }}</h5>
                    <h6 class="card-subtitle mb-2 text-muted ">Code: {{ classroom.code }}</h6>
                    <p class="card-text"> {{classroom.description|truncatewords:20}} </p>
                    <h1 class="text-center p-2">Student lists</h1>
                    <table class="table table-striped  table-bordered text-center table-dark">
                        <thead>
                          <tr>
                            <th>Student Name</th>
                            <th>Aceept/Decline</th>
                          </tr>
                        </thead>
                        <tbody>
                            {% for student in enrolled_students %}
                                <tr>
                                    <td>{{ student.user.fullName }}</td>
                                    <td>
                                        
                                        {% if student.status is not True %}
                                            <a href="{% url 'classJoinAccept' student.id %}" class="btn btn-success">Accept</a>
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <h1 class="text-center p-3">Post Section</h1>
                    <form action="{% url 'courseDetails' classroom.id %}" method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        {{ form.media }}
                        {{ form.as_p }}
                        <button type="submit" class="btn btn-success">Save</button>
                    </form>
                    <h2 class="text-center p-3">Post lists</h2>
                    <div class="container">
                        {% for post in posts %}
                            <div class="card card-outline-success">
                                <div class="card-body">
                                    <span style="float: right;">
                                        <a href="{% url 'postEdit' post.id %}" title="Edit this Post"><i class="fa fa-edit "  aria-hidden="true"></i></a>
                                        <a href="javascript:;" onclick = "deletePost('{% url 'postDelete' post.id %}')" title="Delete this Post"><i class="fa fa-trash ml-3 post-delete"  aria-hidden="true"></i></a>
                                    </span>

                                    <p class="card-text">{{ post.description|safe }}</p>
                                    
                                    {% if post.file %}
                                        <h5 class="card-title"><a href="{{ MEDIA_URL }}{{ post.file.url }}">{{ post.file }}</a></h5>
                                    {% endif %}
                                </div>
                                <h3 class="text-center">Comments</h3>
                                <div class="container">
                                    {% for comment in comments %}
                                      <h5>{{ comment.user.fullName }}</h5>
                                      <p>{{ comment.comment }}</p>
                                      <hr>
                                    {% endfor %}
                                </div>
                                <form action="{% url 'postComment' post.id %}" method="POST">
                                    {% csrf_token %}
                                    {{ comment_form.as_p }}
                                    <input type="submit" value="Comment" style="float: right;" class="btn btn-primary m-3 mt-0">
                                </form>
                            </div>
                            <br>
                            <br>
                        {% endfor %}
                    </div>
                    </div>
                </div>
            </div>
        </div>


    
    {% else %}
        <div class="mt-5">
            <div class="card">
                <div class="card-body">
                <h5 class="card-title">No such classroom found.</h5>
                </div>
            </div>
        </div>
    {% endif %}
        

{% endblock main %}


{% block site_js %}
<script>
    function deletePost(url){
        $(document).on("click", ".post-delete", function(e) {
            bootbox.confirm({
                title: "Destroy planet?",
                message: "Do you want to activate the Deathstar now? This cannot be undone.",
                buttons: {
                    cancel: {
                        label: '<i class="fa fa-times"></i> Cancel'
                    },
                    confirm: {
                        label: '<i class="fa fa-check"></i> Confirm'
                    }
                },
                callback: function (result) {
                    if(result){
                        window.location = url;
                    }
                }
            });
        });
    
    }

</script>
{% endblock site_js %}